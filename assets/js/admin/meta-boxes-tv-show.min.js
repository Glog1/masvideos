jQuery(function(t){function e(e){var s=t(e).next().is(".hasDatepicker")?"minDate":"maxDate",a="minDate"===s?t(e).next():t(e).prev(),o=t(e).datepicker("getDate");t(a).datepicker("option",s,o),t(e).change()}function s(){t(".tv_show_seasons .masvideos_season").each(function(e,s){t(".season_position",s).val(parseInt(t(s).index(".tv_show_seasons .masvideos_season"),10))})}function a(){t(".tv_show_attributes .masvideos_attribute").each(function(e,s){t(".attribute_position",s).val(parseInt(t(s).index(".tv_show_attributes .masvideos_attribute"),10))})}t(function(){t('[id$="-all"] > ul.categorychecklist').each(function(){var e=t(this),s=e.find(":checked").first();if(s.length){var a=e.find("input").position().top,o=s.position().top;e.closest(".tabs-panel").scrollTop(o-a+5)}})}),t("#upsell_tv_show_data").bind("keypress",function(t){if(13===t.keyCode)return!1}),t(".type_box").appendTo("#masvideos-tv-show-data .hndle span"),t("._tv_show_release_date_field").each(function(){t(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){e(t(this))}}),t(this).find("input").each(function(){e(t(this))})});var o=t(".tv_show_seasons").find(".masvideos_season").get();o.sort(function(e,s){var a=parseInt(t(e).attr("rel"),10),o=parseInt(t(s).attr("rel"),10);return a<o?-1:a>o?1:0}),t(o).each(function(e,s){t(".tv_show_seasons").append(s)}),t("button.add_tv_show_season").on("click",function(){var e=t(".tv_show_seasons .masvideos_season").length,a=t(this).closest("#tv_show_seasons").find(".tv_show_seasons"),o={action:"masvideos_add_season_tv_show",i:e,security:masvideos_admin_meta_boxes.add_season_tv_show_nonce};return t.post(masvideos_admin_meta_boxes.ajax_url,o,function(e){a.append(e),t(document.body).trigger("masvideos-enhanced-select-init"),s(),t(document.body).trigger("masvideos_added_season_tv_show")}),!1}),t(".tv_show_seasons").on("blur","input.season_name",function(){t(this).closest(".masvideos_season").find("strong.season_name").text(t(this).val())}),t(".tv_show_seasons").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_season)){var e=t(this).parent().parent();e.find("select, input[type=text]").val(""),e.hide(),s()}return!1}),t(".tv_show_seasons").sortable({items:".masvideos_season",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),s()}}),t(".save_seasons_tv_show").on("click",function(){var e={post_id:masvideos_admin_meta_boxes.post_id,data:t(".tv_show_seasons").find("input, select, textarea").serialize(),action:"masvideos_save_seasons_tv_show",security:masvideos_admin_meta_boxes.save_seasons_tv_show_nonce};t.post(masvideos_admin_meta_boxes.ajax_url,e,function(){var t=window.location.toString();t=t.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&")})});var i=t(".tv_show_attributes").find(".masvideos_attribute").get();i.sort(function(e,s){var a=parseInt(t(e).attr("rel"),10),o=parseInt(t(s).attr("rel"),10);return a<o?-1:a>o?1:0}),t(i).each(function(e,s){t(".tv_show_attributes").append(s)}),t(".tv_show_attributes .masvideos_attribute").each(function(e,s){"none"!==t(s).css("display")&&t(s).is(".taxonomy")&&t("select.attribute_taxonomy").find('option[value="'+t(s).data("taxonomy")+'"]').attr("disabled","disabled")}),t("button.add_attribute_tv_show").on("click",function(){var e=t(".tv_show_attributes .masvideos_attribute").length,s=t("select.attribute_taxonomy").val(),o=t(this).closest("#tv_show_attributes").find(".tv_show_attributes"),i={action:"masvideos_add_attribute_tv_show",taxonomy:s,i:e,security:masvideos_admin_meta_boxes.add_attribute_tv_show_nonce};return t.post(masvideos_admin_meta_boxes.ajax_url,i,function(e){o.append(e),t(document.body).trigger("masvideos-enhanced-select-init"),a(),t(document.body).trigger("masvideos_added_attribute_tv_show")}),s&&(t("select.attribute_taxonomy").find('option[value="'+s+'"]').attr("disabled","disabled"),t("select.attribute_taxonomy").val("")),!1}),t(".tv_show_attributes").on("blur","input.attribute_name",function(){t(this).closest(".masvideos_attribute").find("strong.attribute_name").text(t(this).val())}),t(".tv_show_attributes").on("click","button.select_all_attributes",function(){return t(this).closest("td").find("select option").attr("selected","selected"),t(this).closest("td").find("select").change(),!1}),t(".tv_show_attributes").on("click","button.select_no_attributes",function(){return t(this).closest("td").find("select option").removeAttr("selected"),t(this).closest("td").find("select").change(),!1}),t(".tv_show_attributes").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_attribute)){var e=t(this).parent().parent();e.is(".taxonomy")?(e.find("select, input[type=text]").val(""),e.hide(),t("select.attribute_taxonomy").find('option[value="'+e.data("taxonomy")+'"]').removeAttr("disabled")):(e.find("select, input[type=text]").val(""),e.hide(),a())}return!1}),t(".tv_show_attributes").sortable({items:".masvideos_attribute",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),a()}}),t(".tv_show_attributes").on("click","button.add_new_attribute",function(){var e=t(this).closest(".masvideos_attribute"),s=e.data("taxonomy"),a=window.prompt(masvideos_admin_meta_boxes.new_attribute_prompt);if(a){var o={action:"masvideos_add_new_attribute_tv_show",taxonomy:s,term:a,security:masvideos_admin_meta_boxes.add_attribute_tv_show_nonce};t.post(masvideos_admin_meta_boxes.ajax_url,o,function(t){t.error?window.alert(t.error):t.slug&&(e.find("select.attribute_values").append('<option value="'+t.term_id+'" selected="selected">'+t.name+"</option>"),e.find("select.attribute_values").change())})}return!1}),t(".save_attributes_tv_show").on("click",function(){var e={post_id:masvideos_admin_meta_boxes.post_id,data:t(".tv_show_attributes").find("input, select, textarea").serialize(),action:"masvideos_save_attributes_tv_show",security:masvideos_admin_meta_boxes.save_attributes_tv_show_nonce};t.post(masvideos_admin_meta_boxes.ajax_url,e,function(){var t=window.location.toString();t=t.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&")})});var n,r=t("#tv_show_image_gallery"),_=t("#tv_show_images_container").find("ul.tv_show_images");t(".add_tv_show_images").on("click","a",function(e){var s=t(this);e.preventDefault(),n?n.open():((n=wp.media.frames.tv_show_gallery=wp.media({title:s.data("choose"),button:{text:s.data("update")},states:[new wp.media.controller.Library({title:s.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var t=n.state().get("selection"),e=r.val();t.map(function(t){if((t=t.toJSON()).id){e=e?e+","+t.id:t.id;var a=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;_.append('<li class="image" data-attachment_id="'+t.id+'"><img src="'+a+'" /><ul class="actions"><li><a href="#" class="delete" title="'+s.data("delete")+'">'+s.data("text")+"</a></li></ul></li>")}}),r.val(e)}),n.open())}),_.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")},update:function(){var e="";t("#tv_show_images_container").find("ul li.image").css("cursor","default").each(function(){var s=t(this).attr("data-attachment_id");e=e+s+","}),r.val(e)}}),t("#tv_show_images_container").on("click","a.delete",function(){t(this).closest("li.image").remove();var e="";return t("#tv_show_images_container").find("ul li.image").css("cursor","default").each(function(){var s=t(this).attr("data-attachment_id");e=e+s+","}),r.val(e),t("#tiptip_holder").removeAttr("style"),t("#tiptip_arrow").removeAttr("style"),!1})});