jQuery(function(e){function t(t){var s=e(t).next().is(".hasDatepicker")?"minDate":"maxDate",a="minDate"===s?e(t).next():e(t).prev(),o=e(t).datepicker("getDate");e(a).datepicker("option",s,o),e(t).change()}function s(){e(".tv_show_seasons .masvideos_season").each(function(t,s){e(".season_position",s).val(parseInt(e(s).index(".tv_show_seasons .masvideos_season"),10))})}e(function(){e('[id$="-all"] > ul.categorychecklist').each(function(){var t=e(this),s=t.find(":checked").first();if(s.length){var a=t.find("input").position().top,o=s.position().top;t.closest(".tabs-panel").scrollTop(o-a+5)}})}),e("#upsell_tv_show_data").bind("keypress",function(e){if(13===e.keyCode)return!1}),e(".type_box").appendTo("#masvideos-tv-show-data .hndle span"),e("._tv_show_release_date_field").each(function(){e(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){t(e(this))}}),e(this).find("input").each(function(){t(e(this))})});var a=e(".tv_show_seasons").find(".masvideos_season").get();a.sort(function(t,s){var a=parseInt(e(t).attr("rel"),10),o=parseInt(e(s).attr("rel"),10);return a<o?-1:a>o?1:0}),e(a).each(function(t,s){e(".tv_show_seasons").append(s)}),e("button.add_tv_show_season").on("click",function(){var t=e(".tv_show_seasons .masvideos_season").length,a=e(this).closest("#tv_show_seasons").find(".tv_show_seasons"),o={action:"masvideos_add_season_tv_show",i:t,security:masvideos_admin_meta_boxes.add_season_tv_show_nonce};return e.post(masvideos_admin_meta_boxes.ajax_url,o,function(t){a.append(t),e(document.body).trigger("masvideos-enhanced-select-init"),s(),e(document.body).trigger("masvideos_added_season_tv_show")}),!1}),e(".tv_show_seasons").on("blur","input.season_name",function(){e(this).closest(".masvideos_season").find("strong.season_name").text(e(this).val())}),e(".tv_show_seasons").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_season)){var t=e(this).parent().parent();t.find("select, input[type=text]").val(""),t.hide(),s()}return!1}),e(".tv_show_seasons").sortable({items:".masvideos_season",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),s()}}),e(".save_seasons_tv_show").on("click",function(){var t={post_id:masvideos_admin_meta_boxes.post_id,data:e(".tv_show_seasons").find("input, select, textarea").serialize(),action:"masvideos_save_seasons_tv_show",security:masvideos_admin_meta_boxes.save_seasons_tv_show_nonce};e.post(masvideos_admin_meta_boxes.ajax_url,t,function(){var e=window.location.toString();e=e.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&")})});var o,i=e("#tv_show_image_gallery"),n=e("#tv_show_images_container").find("ul.tv_show_images");e(".add_tv_show_images").on("click","a",function(t){var s=e(this);t.preventDefault(),o?o.open():((o=wp.media.frames.tv_show_gallery=wp.media({title:s.data("choose"),button:{text:s.data("update")},states:[new wp.media.controller.Library({title:s.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var e=o.state().get("selection"),t=i.val();e.map(function(e){if((e=e.toJSON()).id){t=t?t+","+e.id:e.id;var a=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;n.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+a+'" /><ul class="actions"><li><a href="#" class="delete" title="'+s.data("delete")+'">'+s.data("text")+"</a></li></ul></li>")}}),i.val(t)}),o.open())}),n.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";e("#tv_show_images_container").find("ul li.image").css("cursor","default").each(function(){var s=e(this).attr("data-attachment_id");t=t+s+","}),i.val(t)}}),e("#tv_show_images_container").on("click","a.delete",function(){e(this).closest("li.image").remove();var t="";return e("#tv_show_images_container").find("ul li.image").css("cursor","default").each(function(){var s=e(this).attr("data-attachment_id");t=t+s+","}),i.val(t),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),!1})});