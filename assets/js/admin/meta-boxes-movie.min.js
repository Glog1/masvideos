jQuery(function(n){function e(e){var t=n(e).next().is(".hasDatepicker")?"minDate":"maxDate",o="minDate"===t?n(e).next():n(e).prev(),i=n(e).datepicker("getDate");n(o).datepicker("option",t,i),n(e).change()}n(function(){n('[id$="-all"] > ul.categorychecklist').each(function(){var e=n(this),t=e.find(":checked").first();if(t.length){var o=e.find("input").position().top,i=t.position().top;e.closest(".tabs-panel").scrollTop(i-o+5)}})}),n("#upsell_movie_data").bind("keypress",function(e){if(13===e.keyCode)return!1}),n(".type_box").appendTo("#masvideos-movie-data .handle span"),n(".movie_date_picker").each(function(){n(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){e(n(this))}}),n(this).find("input").each(function(){e(n(this))})});var t=n(".movie_persons").find(".masvideos_person").get();function r(){n(".movie_persons .masvideos_person").each(function(e,t){n(".person_position",t).val(parseInt(n(t).index(".movie_persons .masvideos_person"),10))})}t.sort(function(e,t){var o=parseInt(n(e).attr("rel"),10),i=parseInt(n(t).attr("rel"),10);return o<i?-1:i<o?1:0}),n(t).each(function(e,t){n(".movie_persons").append(t)}),n(".movie_persons .masvideos_person").each(function(e,t){if("none"!==n(t).css("display")){var o=n("select.person_id").data("exclude")||[];o.push(n(t).data("person_id")),n("select.person_id").data("exclude",o)}}),n("button.add_person_movie").on("click",function(){var e=n(".movie_persons .masvideos_person").length,t=n("select.person_id").val(),o=n(this).closest("#movie_persons"),i=o.find(".movie_persons"),s={action:"masvideos_add_person_movie",person_id:t,i:e,security:masvideos_admin_meta_boxes.add_person_movie_nonce};if(o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.post(masvideos_admin_meta_boxes.ajax_url,s,function(e){i.append(e),n(document.body).trigger("masvideos-enhanced-select-init"),r(),o.unblock(),n(document.body).trigger("masvideos_added_person_movie")}),t){var a=n("select.person_id").data("exclude")||[];a.push(t),n("select.person_id").data("exclude",a),n("select.person_id").val("").trigger("change")}return!1}),n(".movie_persons").on("blur","input.person_id",function(){n(this).closest(".masvideos_person").find("strong.person_id").text(n(this).val())}),n(".movie_persons").on("click","button.select_all_categoires",function(){return n(this).closest("td").find("select option").attr("selected","selected"),n(this).closest("td").find("select").change(),!1}),n(".movie_persons").on("click","button.select_no_categoires",function(){return n(this).closest("td").find("select option").removeAttr("selected"),n(this).closest("td").find("select").change(),!1}),n(".movie_persons").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_person)){var e=n(this).parent().parent();e.find("select, input[type=text]").val(""),e.hide();var t=n("select.person_id").data("exclude")||[];t.splice(n.inArray(e.data("person_id"),t),1),n("select.person_id").data("exclude",t),r()}return!1}),n(".movie_persons").sortable({items:".masvideos_person",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),r()}}),n(".save_persons_movie").on("click",function(){n("#masvideos-movie-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={post_id:masvideos_admin_meta_boxes.post_id,data:n(".movie_persons").find("input, select, textarea").serialize(),action:"masvideos_save_persons_movie",security:masvideos_admin_meta_boxes.save_persons_movie_nonce};n.post(masvideos_admin_meta_boxes.ajax_url,e,function(){var e=window.location.toString();e=e.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&"),n("#masvideos-movie-data").unblock()})});var o=n(".movie_sources").find(".masvideos_source").get();function s(){n(".movie_sources .masvideos_source").each(function(e,t){n(".source_position",t).val(parseInt(n(t).index(".movie_sources .masvideos_source"),10))})}o.sort(function(e,t){var o=parseInt(n(e).attr("rel"),10),i=parseInt(n(t).attr("rel"),10);return o<i?-1:i<o?1:0}),n(o).each(function(e,t){n(".movie_sources").append(t)}),n("button.add_movie_source").on("click",function(){var e=n(".movie_sources .masvideos_source").length,t=n(this).closest("#movie_sources"),o=t.find(".movie_sources"),i={action:"masvideos_add_source_movie",i:e,security:masvideos_admin_meta_boxes.add_source_movie_nonce};return t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.post(masvideos_admin_meta_boxes.ajax_url,i,function(e){o.append(e),n(document.body).trigger("masvideos-enhanced-select-init"),s(),t.unblock(),n(document.body).trigger("masvideos_added_source_movie")}),!1}),n(".movie_sources").on("blur","input.source_name",function(){n(this).closest(".masvideos_source").find("strong.source_name").text(n(this).val())}),n(".movie_sources").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_source)){var e=n(this).parent().parent();e.find("select, input[type=text]").val(""),e.hide(),s()}return!1}),n(".movie_sources").sortable({items:".masvideos_source",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),s()}}),n(".save_sources_movie").on("click",function(){n("#masvideos-movie-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={post_id:masvideos_admin_meta_boxes.post_id,data:n(".movie_sources").find("input, select, textarea").serialize(),action:"masvideos_save_sources_movie",security:masvideos_admin_meta_boxes.save_sources_movie_nonce};n.post(masvideos_admin_meta_boxes.ajax_url,e,function(){var e=window.location.toString();e=e.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&"),n("#masvideos-movie-data").unblock()})});var a,i=n(".movie_attributes").find(".masvideos_attribute").get();function c(){n(".movie_attributes .masvideos_attribute").each(function(e,t){n(".attribute_position",t).val(parseInt(n(t).index(".movie_attributes .masvideos_attribute"),10))})}i.sort(function(e,t){var o=parseInt(n(e).attr("rel"),10),i=parseInt(n(t).attr("rel"),10);return o<i?-1:i<o?1:0}),n(i).each(function(e,t){n(".movie_attributes").append(t)}),n(".movie_attributes .masvideos_attribute").each(function(e,t){"none"!==n(t).css("display")&&n(t).is(".taxonomy")&&n("select.attribute_taxonomy").find('option[value="'+n(t).data("taxonomy")+'"]').attr("disabled","disabled")}),n("button.add_attribute_movie").on("click",function(){var e=n(".movie_attributes .masvideos_attribute").length,t=n("select.attribute_taxonomy").val(),o=n(this).closest("#movie_attributes"),i=o.find(".movie_attributes"),s={action:"masvideos_add_attribute_movie",taxonomy:t,i:e,security:masvideos_admin_meta_boxes.add_attribute_movie_nonce};return o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.post(masvideos_admin_meta_boxes.ajax_url,s,function(e){i.append(e),n(document.body).trigger("masvideos-enhanced-select-init"),c(),o.unblock(),n(document.body).trigger("masvideos_added_attribute_movie")}),t&&(n("select.attribute_taxonomy").find('option[value="'+t+'"]').attr("disabled","disabled"),n("select.attribute_taxonomy").val("")),!1}),n(".movie_attributes").on("blur","input.attribute_name",function(){n(this).closest(".masvideos_attribute").find("strong.attribute_name").text(n(this).val())}),n(".movie_attributes").on("click","button.select_all_attributes",function(){return n(this).closest("td").find("select option").attr("selected","selected"),n(this).closest("td").find("select").change(),!1}),n(".movie_attributes").on("click","button.select_no_attributes",function(){return n(this).closest("td").find("select option").removeAttr("selected"),n(this).closest("td").find("select").change(),!1}),n(".movie_attributes").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_attribute)){var e=n(this).parent().parent();e.is(".taxonomy")?(e.find("select, input[type=text]").val(""),e.hide(),n("select.attribute_taxonomy").find('option[value="'+e.data("taxonomy")+'"]').removeAttr("disabled")):(e.find("select, input[type=text]").val(""),e.hide(),c())}return!1}),n(".movie_attributes").sortable({items:".masvideos_attribute",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),c()}}),n(".movie_attributes").on("click","button.add_new_attribute",function(){n(".movie_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t=n(this).closest(".masvideos_attribute"),e=t.data("taxonomy"),o=window.prompt(masvideos_admin_meta_boxes.new_attribute_prompt);if(o){var i={action:"masvideos_add_new_attribute_movie",taxonomy:e,term:o,security:masvideos_admin_meta_boxes.add_attribute_movie_nonce};n.post(masvideos_admin_meta_boxes.ajax_url,i,function(e){e.error?window.alert(e.error):e.slug&&(t.find("select.attribute_values").append('<option value="'+e.term_id+'" selected="selected">'+e.name+"</option>"),t.find("select.attribute_values").change()),n(".movie_attributes").unblock()})}else n(".movie_attributes").unblock();return!1}),n(".save_attributes_movie").on("click",function(){n("#masvideos-movie-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={post_id:masvideos_admin_meta_boxes.post_id,data:n(".movie_attributes").find("input, select, textarea").serialize(),action:"masvideos_save_attributes_movie",security:masvideos_admin_meta_boxes.save_attributes_movie_nonce};n.post(masvideos_admin_meta_boxes.ajax_url,e,function(){var e=window.location.toString();e=e.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&"),n("#masvideos-movie-data").unblock()})});var d=n("#movie_image_gallery"),l=n("#movie_images_container").find("ul.movie_images");n(".add_movie_images").on("click","a",function(e){var i=n(this);e.preventDefault(),a||(a=wp.media.frames.movie_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var e=a.state().get("selection"),o=d.val();e.map(function(e){if((e=e.toJSON()).id){o=o?o+","+e.id:e.id;var t=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;l.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+t+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),d.val(o)}),a.open()}),l.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";n("#movie_images_container").find("ul li.image").css("cursor","default").each(function(){var e=n(this).attr("data-attachment_id");t=t+e+","}),d.val(t)}}),n("#movie_images_container").on("click","a.delete",function(){n(this).closest("li.image").remove();var t="";return n("#movie_images_container").find("ul li.image").css("cursor","default").each(function(){var e=n(this).attr("data-attachment_id");t=t+e+","}),d.val(t),n("#tiptip_holder").removeAttr("style"),n("#tiptip_arrow").removeAttr("style"),!1})});